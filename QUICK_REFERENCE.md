# å®šåˆ¶åŒ–AI - å¿«é€Ÿå‚è€ƒå¡ç‰‡

## ğŸš€ 5åˆ†é’Ÿå¿«é€Ÿå¼€å§‹

### 1. æ•°æ®åº“è¿ç§»
```sql
-- åœ¨Supabase Dashboardæ‰§è¡Œ
-- å¤åˆ¶ supabase/migrations/008_custom_ai_configs.sql ä¸­çš„æ‰€æœ‰SQL
```

### 2. ç¯å¢ƒå˜é‡
```bash
# Vercelä¸­æ·»åŠ 
ADMIN_SECRET=your-secret-key
```

### 3. éƒ¨ç½²
```bash
npm run deploy
```

### 4. æµ‹è¯•
```bash
node scripts/test-custom-ai-security.js
node scripts/test-custom-ai-integration.js
```

### 5. é…ç½®å®¢æˆ·
```bash
curl -X POST /api/admin/custom-ai-configs \
  -H "x-admin-token: your-secret" \
  -d '{
    "customer_id": "uuid",
    "dify_app_id": "app-id",
    "dify_api_key": "key",
    "dify_api_url": "https://api.dify.ai/v1"
  }'
```

## ğŸ“ å…³é”®æ–‡ä»¶

| æ–‡ä»¶ | ç”¨é€” |
|------|------|
| `supabase/migrations/008_custom_ai_configs.sql` | æ•°æ®åº“è¿ç§» |
| `app/api/chat-custom/route.ts` | å®šåˆ¶åŒ–èŠå¤©API |
| `app/api/admin/custom-ai-configs/route.ts` | ç®¡ç†å‘˜API |
| `lib/chat-client.ts` | å‰ç«¯å·¥å…· |
| `components/CustomAIConfigManager.tsx` | ç®¡ç†ç•Œé¢ |

## ğŸ”— APIç«¯ç‚¹

### ç”¨æˆ·API
```
GET  /api/user/custom-ai-config          # æ£€æŸ¥é…ç½®
POST /api/chat-custom                    # èŠå¤©
```

### ç®¡ç†å‘˜API
```
GET    /api/admin/custom-ai-configs      # åˆ—è¡¨
POST   /api/admin/custom-ai-configs      # åˆ›å»º
PUT    /api/admin/custom-ai-configs      # æ›´æ–°
DELETE /api/admin/custom-ai-configs?id=  # åˆ é™¤
```

## ğŸ” å®‰å…¨æ£€æŸ¥

- [ ] APIå¯†é’¥å­˜å‚¨åœ¨æ•°æ®åº“
- [ ] å¯†é’¥ä»…åœ¨åç«¯ä½¿ç”¨
- [ ] å‰ç«¯ä¸ä¼šæš´éœ²å¯†é’¥
- [ ] RLSç­–ç•¥å·²é…ç½®
- [ ] ç”¨æˆ·è®¤è¯å·²å®ç°
- [ ] ç®¡ç†å‘˜è®¤è¯å·²å®ç°

## ğŸ“Š æ•°æ®åº“è¡¨

```sql
custom_ai_configs {
  id: UUID
  customer_id: UUID (UNIQUE)
  dify_app_id: VARCHAR
  dify_api_key: VARCHAR
  dify_api_url: VARCHAR
  knowledge_base_id: VARCHAR
  system_prompt: TEXT
  is_active: BOOLEAN
  created_at: TIMESTAMP
  updated_at: TIMESTAMP
}
```

## ğŸ§ª æµ‹è¯•å‘½ä»¤

```bash
# å®‰å…¨æ€§æµ‹è¯•
node scripts/test-custom-ai-security.js

# é›†æˆæµ‹è¯•
node scripts/test-custom-ai-integration.js
```

## ğŸ› å¸¸è§é—®é¢˜

### ç”¨æˆ·æ— æ³•ä½¿ç”¨å®šåˆ¶åŒ–AI
1. æ£€æŸ¥é…ç½®æ˜¯å¦å·²åˆ›å»º
2. æ£€æŸ¥ `is_active` æ˜¯å¦ä¸ºtrue
3. æ£€æŸ¥Dify APIå¯†é’¥æ˜¯å¦æ­£ç¡®
4. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜

### APIè¿”å›401é”™è¯¯
1. æ£€æŸ¥JWTä»¤ç‰Œæ˜¯å¦æœ‰æ•ˆ
2. æ£€æŸ¥Cookieä¸­çš„sid
3. é‡æ–°ç™»å½•ç”¨æˆ·

### å®šåˆ¶åŒ–é…ç½®æœªç”Ÿæ•ˆ
1. éªŒè¯é…ç½®æ˜¯å¦å·²åˆ›å»º
2. æ£€æŸ¥ `is_active` æ˜¯å¦ä¸ºtrue
3. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
4. é‡æ–°ç™»å½•ç”¨æˆ·

### Dify APIå¯†é’¥é”™è¯¯
1. éªŒè¯APIå¯†é’¥æ˜¯å¦æ­£ç¡®
2. æ£€æŸ¥APIå¯†é’¥æ˜¯å¦å·²è¿‡æœŸ
3. éªŒè¯Difyåº”ç”¨æ˜¯å¦å­˜åœ¨
4. æ£€æŸ¥API URLæ˜¯å¦æ­£ç¡®

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | å€¼ |
|------|-----|
| APIå“åº”æ—¶é—´ | < 100ms |
| æ•°æ®åº“æŸ¥è¯¢ | < 10ms |
| é‡è¯•æ¬¡æ•° | æœ€å¤š2æ¬¡ |
| æ€»è¶…æ—¶ | 300ç§’ |
| è¿æ¥è¶…æ—¶ | 10ç§’ |

## ğŸ“š æ–‡æ¡£å¯¼èˆª

| æ–‡æ¡£ | å†…å®¹ |
|------|------|
| `CUSTOM_AI_README.md` | é¡¹ç›®æ¦‚è§ˆ |
| `CUSTOM_AI_TECHNICAL_DESIGN.md` | æŠ€æœ¯ç»†èŠ‚ |
| `CUSTOM_AI_DEPLOYMENT_GUIDE.md` | éƒ¨ç½²æ­¥éª¤ |
| `CUSTOM_AI_IMPLEMENTATION_SUMMARY.md` | å®ç°æ€»ç»“ |
| `PROJECT_COMPLETION_REPORT.md` | å®ŒæˆæŠ¥å‘Š |

## ğŸ”„ å·¥ä½œæµç¨‹

### ç”¨æˆ·èŠå¤©
```
ç”¨æˆ·å‘é€æ¶ˆæ¯
  â†“
æ£€æŸ¥æ˜¯å¦æœ‰å®šåˆ¶åŒ–é…ç½®
  â†“
  â”œâ”€ æœ‰ â†’ /api/chat-custom
  â””â”€ æ—  â†’ /api/chat
  â†“
è¿”å›æµå¼å“åº”
```

### ç®¡ç†å‘˜é…ç½®
```
ç™»å½•ç®¡ç†åå°
  â†“
è¾“å…¥ç®¡ç†å‘˜ä»¤ç‰Œ
  â†“
åˆ›å»º/ç¼–è¾‘/åˆ é™¤é…ç½®
  â†“
é…ç½®ç«‹å³ç”Ÿæ•ˆ
```

## âœ… éƒ¨ç½²æ£€æŸ¥æ¸…å•

- [ ] æ•°æ®åº“è¿ç§»å·²æ‰§è¡Œ
- [ ] ç¯å¢ƒå˜é‡å·²é…ç½®
- [ ] ä»£ç å·²éƒ¨ç½²
- [ ] å®‰å…¨æ€§æµ‹è¯•é€šè¿‡
- [ ] é›†æˆæµ‹è¯•é€šè¿‡
- [ ] è‡³å°‘ä¸€ä¸ªå®¢æˆ·å·²é…ç½®
- [ ] å®šåˆ¶åŒ–AIåŠŸèƒ½å·²éªŒè¯
- [ ] å…±äº«AIåŠŸèƒ½ä»æ­£å¸¸
- [ ] æ—¥å¿—ç›‘æ§å·²è®¾ç½®
- [ ] æ–‡æ¡£å·²æ›´æ–°

## ğŸ¯ å…³é”®æ¦‚å¿µ

| æ¦‚å¿µ | è¯´æ˜ |
|------|------|
| å…±äº«AI | æ‰€æœ‰ç”¨æˆ·ä½¿ç”¨åŒä¸€ä¸ªDifyå®ä¾‹ |
| å®šåˆ¶åŒ–AI | æ¯ä¸ªå®¢æˆ·ä½¿ç”¨ç‹¬ç«‹çš„Difyå®ä¾‹ |
| è‡ªåŠ¨è·¯ç”± | å‰ç«¯è‡ªåŠ¨é€‰æ‹©åˆé€‚çš„APIç«¯ç‚¹ |
| æ•°æ®éš”ç¦» | æ¯ä¸ªå®¢æˆ·çš„æ•°æ®å®Œå…¨ç‹¬ç«‹ |
| å®‰å…¨ä»£ç† | åç«¯ä»£ç†æ‰€æœ‰Difyè¯·æ±‚ |

## ğŸ’¡ æœ€ä½³å®è·µ

1. **å®šæœŸå¤‡ä»½**: å®šæœŸå¤‡ä»½Supabaseæ•°æ®åº“
2. **ç›‘æ§æ—¥å¿—**: ç›‘æ§Vercelå’ŒSupabaseæ—¥å¿—
3. **å®‰å…¨å®¡è®¡**: å®šæœŸå®¡è®¡APIå¯†é’¥å’Œæƒé™
4. **æ–‡æ¡£æ›´æ–°**: åŠæ—¶æ›´æ–°éƒ¨ç½²å’Œé…ç½®æ–‡æ¡£
5. **æ€§èƒ½ç›‘æ§**: ç›‘æ§APIå“åº”æ—¶é—´å’Œé”™è¯¯ç‡

## ğŸš¨ ç´§æ€¥å¤„ç†

### ç³»ç»Ÿæ•…éšœ
1. æ£€æŸ¥Verceléƒ¨ç½²çŠ¶æ€
2. æ£€æŸ¥Supabaseè¿æ¥
3. æ£€æŸ¥Dify APIå¯ç”¨æ€§
4. æŸ¥çœ‹é”™è¯¯æ—¥å¿—

### æ•°æ®æ³„éœ²
1. ç«‹å³æ›´æ¢æ‰€æœ‰APIå¯†é’¥
2. æ£€æŸ¥æ—¥å¿—ä¸­çš„å¼‚å¸¸è®¿é—®
3. é€šçŸ¥å—å½±å“çš„å®¢æˆ·
4. æ›´æ–°å®‰å…¨ç­–ç•¥

### æ€§èƒ½é—®é¢˜
1. æ£€æŸ¥æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½
2. æ£€æŸ¥APIå“åº”æ—¶é—´
3. æ£€æŸ¥Dify APIæ€§èƒ½
4. ä¼˜åŒ–æ•°æ®åº“ç´¢å¼•

## ğŸ“ è·å–å¸®åŠ©

1. æŸ¥çœ‹ç›¸å…³æ–‡æ¡£
2. è¿è¡Œæµ‹è¯•è„šæœ¬
3. æ£€æŸ¥é”™è¯¯æ—¥å¿—
4. æŸ¥çœ‹ä»£ç æ³¨é‡Š

---

**æœ€åæ›´æ–°**: 2025-11-02  
**ç‰ˆæœ¬**: 1.0  
**çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª

